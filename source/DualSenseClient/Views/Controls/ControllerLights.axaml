<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:ic="using:FluentIcons.Avalonia.Fluent"
             xmlns:vm="clr-namespace:DualSenseClient.ViewModels.Controls"
             xmlns:local="clr-namespace:DualSenseClient.Views.Controls"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="600"
             x:Class="DualSenseClient.Views.Controls.ControllerLights"
             x:DataType="vm:ControllerProfileViewModel">

    <UserControl.Styles>
        <!-- Consistent button styling -->
        <Style Selector="Button.preset-button">
            <Setter Property="MinWidth" Value="32" />
            <Setter Property="MinHeight" Value="32" />
            <Setter Property="Padding" Value="0" />
            <Setter Property="CornerRadius" Value="4" />
            <Setter Property="BorderThickness" Value="2" />
            <Setter Property="BorderBrush" Value="Transparent" />
        </Style>
        <Style Selector="Button.preset-button:pointerover">
            <Setter Property="BorderBrush" Value="{DynamicResource SystemAccentColorBrush}" />
        </Style>

        <Style Selector="Button.action-button">
            <Setter Property="Padding" Value="8,6" />
            <Setter Property="MinWidth" Value="36" />
        </Style>

        <Style Selector="Button.apply-button">
            <Setter Property="Background" Value="{DynamicResource SystemAccentColorBrush}" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Padding" Value="12,8" />
        </Style>

        <Style Selector="TextBlock.section-header">
            <Setter Property="FontSize" Value="14" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Margin" Value="0,0,0,8" />
        </Style>
    </UserControl.Styles>

    <ScrollViewer HorizontalScrollBarVisibility="Disabled"
                  VerticalScrollBarVisibility="Auto">
        <Border Background="{DynamicResource ApplicationPageBackgroundThemeBrush}"
                CornerRadius="8"
                Padding="20">
            <StackPanel Spacing="16">
                <!-- Compact Header -->
                <Grid ColumnDefinitions="Auto,*,Auto">
                    <Grid ColumnDefinitions="Auto,*">
                        <ic:SymbolIcon Symbol="LightbulbFilament"
                                       FontSize="24"
                                       Margin="0,0,12,0"
                                       VerticalAlignment="Center" />
                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                            <TextBlock Text="Lights"
                                       FontSize="20"
                                       FontWeight="SemiBold" />
                            <TextBlock Text="Personalize how your controller looks by changing the lightbar color and player LED behavior."
                                       FontSize="13"
                                       Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                                       Margin="0,2,0,0" />
                        </StackPanel>
                    </Grid>

                    <!-- Quick Actions in Header -->
                    <StackPanel Grid.Column="2"
                                Orientation="Horizontal"
                                Spacing="4">
                        <Button Command="{Binding ResetLightsToDefaultCommand}"
                                ToolTip.Tip="Reset to Default"
                                Classes="action-button">
                            <ic:SymbolIcon Symbol="ArrowReset" FontSize="14" />
                        </Button>
                        <Button Command="{Binding TurnOffAllLightsCommand}"
                                ToolTip.Tip="Turn Off All Lights"
                                Classes="action-button">
                            <ic:SymbolIcon Symbol="Lightbulb" FontSize="14" />
                        </Button>
                    </StackPanel>
                </Grid>

                <Border Height="1"
                        Background="{DynamicResource DividerStrokeColorDefaultBrush}" />

                <!-- Main Content in Two Columns -->
                <Grid ColumnDefinitions="*,280" ColumnSpacing="16">

                    <!-- Left Column: Light Controls -->
                    <StackPanel Grid.Column="0" Spacing="16">

                        <!-- Lightbar Control -->
                        <Border Background="{DynamicResource LayerFillColorDefaultBrush}"
                                CornerRadius="6"
                                Padding="12">
                            <StackPanel Spacing="12">
                                <TextBlock Text="Lightbar Color"
                                           Classes="section-header" />

                                <!-- Color Preview with Hex -->
                                <Border Background="{Binding LightbarPreviewColor}"
                                        CornerRadius="4"
                                        Height="40"
                                        BorderBrush="{DynamicResource DividerStrokeColorDefaultBrush}"
                                        BorderThickness="1">
                                    <Grid>
                                        <TextBlock Text="{Binding LightbarColorHex}"
                                                   HorizontalAlignment="Center"
                                                   VerticalAlignment="Center"
                                                   FontFamily="Cascadia Code,Consolas,monospace"
                                                   FontSize="14"
                                                   FontWeight="SemiBold"
                                                   Foreground="White">
                                            <TextBlock.Effect>
                                                <DropShadowEffect Color="Black"
                                                                  BlurRadius="4"
                                                                  OffsetX="0"
                                                                  OffsetY="1" />
                                            </TextBlock.Effect>
                                        </TextBlock>
                                    </Grid>
                                </Border>

                                <!-- RGB Sliders in Compact Layout -->
                                <Grid RowDefinitions="Auto,Auto,Auto" RowSpacing="8">
                                    <!-- Red -->
                                    <Grid ColumnDefinitions="24,*,45">
                                        <Border Background="{DynamicResource SystemFillColorCriticalBrush}"
                                                CornerRadius="3"
                                                Width="20"
                                                Height="20" />
                                        <Slider Grid.Column="1"
                                                Margin="8,0"
                                                Minimum="0"
                                                Maximum="255"
                                                Value="{Binding LightbarRed}"
                                                TickFrequency="1"
                                                IsSnapToTickEnabled="True" />
                                        <TextBlock Grid.Column="2"
                                                   Text="{Binding LightbarRed}"
                                                   VerticalAlignment="Center"
                                                   HorizontalAlignment="Right"
                                                   FontFamily="Cascadia Code,Consolas,monospace"
                                                   FontSize="11" />
                                    </Grid>

                                    <!-- Green -->
                                    <Grid Grid.Row="1" ColumnDefinitions="24,*,45">
                                        <Border Background="{DynamicResource SystemFillColorSuccessBrush}"
                                                CornerRadius="3"
                                                Width="20"
                                                Height="20" />
                                        <Slider Grid.Column="1"
                                                Margin="8,0"
                                                Minimum="0"
                                                Maximum="255"
                                                Value="{Binding LightbarGreen}"
                                                TickFrequency="1"
                                                IsSnapToTickEnabled="True" />
                                        <TextBlock Grid.Column="2"
                                                   Text="{Binding LightbarGreen}"
                                                   VerticalAlignment="Center"
                                                   HorizontalAlignment="Right"
                                                   FontFamily="Cascadia Code,Consolas,monospace"
                                                   FontSize="11" />
                                    </Grid>

                                    <!-- Blue -->
                                    <Grid Grid.Row="2" ColumnDefinitions="24,*,45">
                                        <Border Background="{DynamicResource SystemAccentColorBrush}"
                                                CornerRadius="3"
                                                Width="20"
                                                Height="20" />
                                        <Slider Grid.Column="1"
                                                Margin="8,0"
                                                Minimum="0"
                                                Maximum="255"
                                                Value="{Binding LightbarBlue}"
                                                TickFrequency="1"
                                                IsSnapToTickEnabled="True" />
                                        <TextBlock Grid.Column="2"
                                                   Text="{Binding LightbarBlue}"
                                                   VerticalAlignment="Center"
                                                   HorizontalAlignment="Right"
                                                   FontFamily="Cascadia Code,Consolas,monospace"
                                                   FontSize="11" />
                                    </Grid>
                                </Grid>

                                <!-- Color Presets -->
                                <Grid ColumnDefinitions="Auto,*">
                                    <TextBlock Text="Presets:"
                                               FontSize="11"
                                               VerticalAlignment="Center"
                                               Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                                               Margin="0,0,8,0" />
                                    <ItemsControl Grid.Column="1"
                                                  HorizontalAlignment="Left">
                                        <ItemsControl.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <WrapPanel Orientation="Horizontal" />
                                            </ItemsPanelTemplate>
                                        </ItemsControl.ItemsPanel>
                                        <Button Background="{DynamicResource SystemFillColorCriticalBrush}" Command="{Binding SetLightbarPresetCommand}" CommandParameter="255,0,0" Classes="preset-button" Margin="2" ToolTip.Tip="Red" />
                                        <Button Background="{DynamicResource SystemFillColorSuccessBrush}" Command="{Binding SetLightbarPresetCommand}" CommandParameter="0,255,0" Classes="preset-button" Margin="2" ToolTip.Tip="Green" />
                                        <Button Background="{DynamicResource SystemAccentColorBrush}" Command="{Binding SetLightbarPresetCommand}" CommandParameter="0,0,255" Classes="preset-button" Margin="2" ToolTip.Tip="Blue" />
                                        <Button Background="{DynamicResource SystemFillColorCautionBrush}" Command="{Binding SetLightbarPresetCommand}" CommandParameter="255,255,0" Classes="preset-button" Margin="2" ToolTip.Tip="Yellow" />
                                        <Button Background="#FF6B9D" Command="{Binding SetLightbarPresetCommand}" CommandParameter="255,0,255" Classes="preset-button" Margin="2" ToolTip.Tip="Magenta" />
                                        <Button Background="#00FFFF" Command="{Binding SetLightbarPresetCommand}" CommandParameter="0,255,255" Classes="preset-button" Margin="2" ToolTip.Tip="Cyan" />
                                        <Button Background="#FFFFFF" Command="{Binding SetLightbarPresetCommand}" CommandParameter="255,255,255" Classes="preset-button" Margin="2" ToolTip.Tip="White" />
                                        <Button Background="#FFA500" Command="{Binding SetLightbarPresetCommand}" CommandParameter="255,165,0" Classes="preset-button" Margin="2" ToolTip.Tip="Orange" />
                                    </ItemsControl>
                                </Grid>

                                <Button Content="Apply Lightbar"
                                        Command="{Binding ApplyLightbarCommand}"
                                        HorizontalAlignment="Stretch"
                                        Classes="apply-button"
                                        Foreground="{DynamicResource TextFillColorInverseBrush}" />
                            </StackPanel>
                        </Border>

                        <!-- Player LEDs -->
                        <Border Background="{DynamicResource LayerFillColorDefaultBrush}"
                                CornerRadius="6"
                                Padding="12">
                            <StackPanel Spacing="12">
                                <Grid ColumnDefinitions="*,Auto">
                                    <TextBlock Text="Player LEDs"
                                               Classes="section-header" />
                                    <ComboBox Grid.Column="1"
                                              SelectedIndex="{Binding PlayerLedBrightnessIndex}"
                                              MinWidth="100">
                                        <ComboBoxItem Content="High" />
                                        <ComboBoxItem Content="Medium" />
                                        <ComboBoxItem Content="Low" />
                                    </ComboBox>
                                </Grid>

                                <!-- LED Toggle Buttons -->
                                <Grid ColumnDefinitions="*,*,*,*,*" ColumnSpacing="4">
                                    <ToggleButton Grid.Column="0"
                                                  Content="1"
                                                  IsChecked="{Binding PlayerLed1}"
                                                  HorizontalAlignment="Stretch"
                                                  Height="40"
                                                  FontWeight="SemiBold" />
                                    <ToggleButton Grid.Column="1"
                                                  Content="2"
                                                  IsChecked="{Binding PlayerLed2}"
                                                  HorizontalAlignment="Stretch"
                                                  Height="40"
                                                  FontWeight="SemiBold" />
                                    <ToggleButton Grid.Column="2"
                                                  Content="3"
                                                  IsChecked="{Binding PlayerLed3}"
                                                  HorizontalAlignment="Stretch"
                                                  Height="40"
                                                  FontWeight="SemiBold" />
                                    <ToggleButton Grid.Column="3"
                                                  Content="4"
                                                  IsChecked="{Binding PlayerLed4}"
                                                  HorizontalAlignment="Stretch"
                                                  Height="40"
                                                  FontWeight="SemiBold" />
                                    <ToggleButton Grid.Column="4"
                                                  Content="5"
                                                  IsChecked="{Binding PlayerLed5}"
                                                  HorizontalAlignment="Stretch"
                                                  Height="40"
                                                  FontWeight="SemiBold" />
                                </Grid>

                                <!-- Quick Presets -->
                                <Grid ColumnDefinitions="*,*,*" ColumnSpacing="4">
                                    <Button Grid.Column="0"
                                            Content="All On"
                                            Command="{Binding SetPlayerLedsCommand}"
                                            CommandParameter="All"
                                            FontSize="12"
                                            HorizontalAlignment="Stretch" />
                                    <Button Grid.Column="1"
                                            Content="Center"
                                            Command="{Binding SetPlayerLedsCommand}"
                                            CommandParameter="Center"
                                            FontSize="12"
                                            HorizontalAlignment="Stretch" />
                                    <Button Grid.Column="2"
                                            Content="All Off"
                                            Command="{Binding SetPlayerLedsCommand}"
                                            CommandParameter="None"
                                            FontSize="12"
                                            HorizontalAlignment="Stretch" />
                                </Grid>

                                <Button Content="Apply Player LEDs"
                                        Command="{Binding ApplyPlayerLedsCommand}"
                                        HorizontalAlignment="Stretch"
                                        Classes="apply-button"
                                        Foreground="{DynamicResource TextFillColorInverseBrush}" />
                            </StackPanel>
                        </Border>
                    </StackPanel>

                    <!-- Right Column: Profile Management & Mic LED -->
                    <StackPanel Grid.Column="1" Spacing="16">

                        <!-- Profile Management -->
                        <Border Background="{DynamicResource LayerFillColorDefaultBrush}"
                                CornerRadius="6"
                                Padding="12">
                            <StackPanel Spacing="12">
                                <TextBlock Text="Profile Management"
                                           Classes="section-header" />

                                <!-- New Profile Creation -->
                                <StackPanel Spacing="8">
                                    <TextBox Watermark="Enter profile name..."
                                             Text="{Binding NewProfileName}" />

                                    <Grid ColumnDefinitions="*,*" ColumnSpacing="4">
                                        <Button Grid.Column="0"
                                                Content="Create New"
                                                Command="{Binding SaveCurrentAsProfileCommand}"
                                                IsVisible="{Binding NewProfileName, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                                                FontSize="12">
                                            <Button.IsEnabled>
                                                <MultiBinding Converter="{x:Static BoolConverters.And}">
                                                    <Binding Path="NewProfileName" Converter="{x:Static StringConverters.IsNotNullOrEmpty}" />
                                                </MultiBinding>
                                            </Button.IsEnabled>
                                        </Button>
                                        <Button Grid.Column="1"
                                                Command="{Binding SaveControllerStateAsProfileCommand}"
                                                FontSize="12">
                                            <StackPanel Orientation="Horizontal" Spacing="4">
                                                <ic:SymbolIcon Symbol="Camera" FontSize="12" />
                                                <TextBlock Text="Capture Current" />
                                            </StackPanel>
                                        </Button>
                                    </Grid>
                                </StackPanel>

                                <!-- Profile Info -->
                                <Border Background="{DynamicResource CardBackgroundFillColorSecondaryBrush}"
                                        CornerRadius="4"
                                        Padding="8"
                                        IsVisible="{Binding SelectedProfile, Converter={x:Static ObjectConverters.IsNotNull}}">
                                    <StackPanel Spacing="4">
                                        <TextBlock Text="Current Profile"
                                                   FontSize="11"
                                                   Foreground="{DynamicResource TextFillColorSecondaryBrush}" />
                                        <TextBlock Text="{Binding SelectedProfile.Name}"
                                                   FontWeight="SemiBold"
                                                   TextWrapping="Wrap" />
                                    </StackPanel>
                                </Border>
                            </StackPanel>
                        </Border>

                        <!-- Microphone LED -->
                        <Border Background="{DynamicResource LayerFillColorDefaultBrush}"
                                CornerRadius="6"
                                Padding="12">
                            <StackPanel Spacing="12">
                                <Grid ColumnDefinitions="Auto,*">
                                    <ic:SymbolIcon Symbol="Mic"
                                                   FontSize="14"
                                                   Margin="0,0,6,0"
                                                   VerticalAlignment="Center" />
                                    <TextBlock Text="Microphone LED"
                                               Classes="section-header"
                                               VerticalAlignment="Center"
                                               Grid.Column="1" />
                                </Grid>

                                <StackPanel Spacing="6">
                                    <RadioButton Content="Off"
                                                 GroupName="MicLed"
                                                 IsChecked="{Binding MicLed, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=Off, Mode=TwoWay}" />
                                    <RadioButton Content="On (Solid)"
                                                 GroupName="MicLed"
                                                 IsChecked="{Binding MicLed, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=On, Mode=TwoWay}" />
                                    <RadioButton Content="Pulse (Breathing)"
                                                 GroupName="MicLed"
                                                 IsChecked="{Binding MicLed, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=Pulse, Mode=TwoWay}" />
                                </StackPanel>

                                <Button Content="Apply Mic LED"
                                        Command="{Binding ApplyMicLedCommand}"
                                        HorizontalAlignment="Stretch"
                                        Classes="apply-button"
                                        Foreground="{DynamicResource TextFillColorInverseBrush}" />
                            </StackPanel>
                        </Border>

                        <!-- Quick Actions -->
                        <Border Background="{DynamicResource LayerFillColorAltBrush}"
                                CornerRadius="6"
                                Padding="12"
                                BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                                BorderThickness="1">
                            <StackPanel Spacing="8">
                                <TextBlock Text="Quick Actions"
                                           FontSize="12"
                                           Foreground="{DynamicResource TextFillColorSecondaryBrush}" />
                                <Button Content="Apply All Settings"
                                        Command="{Binding ApplyAllSettingsCommand}"
                                        HorizontalAlignment="Stretch"
                                        FontWeight="SemiBold"
                                        Foreground="{DynamicResource TextFillColorInverseBrush}">
                                    <Button.Styles>
                                        <Style Selector="Button">
                                            <Setter Property="Background" Value="{DynamicResource SystemAccentColorBrush}" />
                                        </Style>
                                    </Button.Styles>
                                </Button>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </Grid>
            </StackPanel>
        </Border>
    </ScrollViewer>
</UserControl>