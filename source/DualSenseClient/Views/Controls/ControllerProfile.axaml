<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:ic="using:FluentIcons.Avalonia.Fluent"
             xmlns:vm="clr-namespace:DualSenseClient.ViewModels.Controls"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             x:Class="DualSenseClient.Views.Controls.ControllerProfile"
             x:DataType="vm:ControllerProfileViewModel">
    <Border Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
            CornerRadius="8"
            Padding="20">
        <StackPanel Spacing="20">
            <!-- Header -->
            <Grid ColumnDefinitions="Auto,*">
                <ic:SymbolIcon Symbol="LightbulbFilament"
                               FontSize="20"
                               Margin="0,0,10,0"
                               VerticalAlignment="Center" />
                <TextBlock Text="Controller Lights Profiles"
                           FontSize="16"
                           FontWeight="SemiBold"
                           VerticalAlignment="Center"
                           Grid.Column="1" />
            </Grid>

            <Border Height="1"
                    Background="{DynamicResource DividerStrokeColorDefaultBrush}" />

            <!-- Content Grid -->
            <Grid RowDefinitions="Auto,Auto,Auto" ColumnDefinitions="*,*" ColumnSpacing="20" RowSpacing="20">

                <!-- Profile Management Section -->
                <Border Background="{DynamicResource LayerFillColorDefaultBrush}"
                        CornerRadius="8"
                        Padding="16"
                        Grid.Row="0"
                        Grid.Column="0"
                        Grid.ColumnSpan="2">
                    <StackPanel Spacing="12">
                        <Grid ColumnDefinitions="Auto,*">
                            <ic:SymbolIcon Symbol="Collections"
                                           FontSize="16"
                                           Margin="0,0,8,0"
                                           VerticalAlignment="Center" />
                            <TextBlock Text="Profiles"
                                       FontSize="14"
                                       FontWeight="SemiBold"
                                       VerticalAlignment="Center"
                                       Grid.Column="1" />
                        </Grid>

                        <!-- Profile Selection and Quick Actions -->
                        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="8">
                            <!-- Profile Dropdown -->
                            <ComboBox ItemsSource="{Binding Profiles}"
                                      SelectedItem="{Binding SelectedProfile}"
                                      HorizontalAlignment="Stretch">
                                <ComboBox.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Name}" />
                                    </DataTemplate>
                                </ComboBox.ItemTemplate>
                            </ComboBox>

                            <!-- Quick Actions -->
                            <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="4">
                                <Button Command="{Binding ApplySelectedProfileCommand}"
                                        ToolTip.Tip="Apply Profile"
                                        Padding="8,6">
                                    <ic:SymbolIcon Symbol="Play" FontSize="14" />
                                </Button>
                                <Button Command="{Binding UpdateSelectedProfileCommand}"
                                        ToolTip.Tip="Update Profile"
                                        Padding="8,6">
                                    <ic:SymbolIcon Symbol="Save" FontSize="14" />
                                </Button>
                                <Button Command="{Binding DuplicateSelectedProfileCommand}"
                                        ToolTip.Tip="Duplicate Profile"
                                        Padding="8,6">
                                    <ic:SymbolIcon Symbol="Copy" FontSize="14" />
                                </Button>
                                <Button Command="{Binding DeleteSelectedProfileCommand}"
                                        ToolTip.Tip="Delete Profile"
                                        Padding="8,6">
                                    <Button.Styles>
                                        <Style Selector="Button">
                                            <Setter Property="Background" Value="{DynamicResource SystemFillColorCriticalBrush}" />
                                        </Style>
                                    </Button.Styles>
                                    <ic:SymbolIcon Symbol="Delete" FontSize="14" />
                                </Button>
                            </StackPanel>
                        </Grid>

                        <!-- Create New Profile -->
                        <Grid ColumnDefinitions="*,Auto,Auto" ColumnSpacing="8">
                            <TextBox Watermark="New profile name..."
                                     Text="{Binding NewProfileName}" />
                            <Button Grid.Column="1"
                                    Content="Create"
                                    Command="{Binding SaveCurrentAsProfileCommand}"
                                    IsEnabled="{Binding NewProfileName, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                                    Padding="12,6" />
                            <Button Grid.Column="2"
                                    ToolTip.Tip="Save current controller state as profile"
                                    Command="{Binding SaveControllerStateAsProfileCommand}"
                                    Padding="8,6">
                                <StackPanel Orientation="Horizontal" Spacing="4">
                                    <ic:SymbolIcon Symbol="Camera" FontSize="14" />
                                    <TextBlock Text="Capture" FontSize="12" />
                                </StackPanel>
                            </Button>
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- Lightbar Section -->
                <Border Background="{DynamicResource LayerFillColorDefaultBrush}"
                        CornerRadius="8"
                        Padding="16"
                        Grid.Row="1"
                        Grid.Column="0"
                        Grid.ColumnSpan="2">
                    <StackPanel Spacing="12">
                        <TextBlock Text="Lightbar"
                                   FontSize="14"
                                   FontWeight="SemiBold" />

                        <Grid ColumnDefinitions="*,140" ColumnSpacing="12">
                            <!-- Color Sliders -->
                            <StackPanel Spacing="10">
                                <!-- Red Slider -->
                                <Grid ColumnDefinitions="30,*,50">
                                    <Border Background="#FF0000"
                                            CornerRadius="4"
                                            Width="24"
                                            Height="24"
                                            VerticalAlignment="Center" />
                                    <Slider Grid.Column="1"
                                            Margin="8,0"
                                            Minimum="0"
                                            Maximum="255"
                                            Value="{Binding LightbarRed}"
                                            TickFrequency="1"
                                            IsSnapToTickEnabled="True" />
                                    <TextBlock Grid.Column="2"
                                               Text="{Binding LightbarRed}"
                                               VerticalAlignment="Center"
                                               HorizontalAlignment="Right"
                                               FontFamily="Consolas"
                                               FontSize="12" />
                                </Grid>

                                <!-- Green Slider -->
                                <Grid ColumnDefinitions="30,*,50">
                                    <Border Background="#00FF00"
                                            CornerRadius="4"
                                            Width="24"
                                            Height="24"
                                            VerticalAlignment="Center" />
                                    <Slider Grid.Column="1"
                                            Margin="8,0"
                                            Minimum="0"
                                            Maximum="255"
                                            Value="{Binding LightbarGreen}"
                                            TickFrequency="1"
                                            IsSnapToTickEnabled="True" />
                                    <TextBlock Grid.Column="2"
                                               Text="{Binding LightbarGreen}"
                                               VerticalAlignment="Center"
                                               HorizontalAlignment="Right"
                                               FontFamily="Consolas"
                                               FontSize="12" />
                                </Grid>

                                <!-- Blue Slider -->
                                <Grid ColumnDefinitions="30,*,50">
                                    <Border Background="#0000FF"
                                            CornerRadius="4"
                                            Width="24"
                                            Height="24"
                                            VerticalAlignment="Center" />
                                    <Slider Grid.Column="1"
                                            Margin="8,0"
                                            Minimum="0"
                                            Maximum="255"
                                            Value="{Binding LightbarBlue}"
                                            TickFrequency="1"
                                            IsSnapToTickEnabled="True" />
                                    <TextBlock Grid.Column="2"
                                               Text="{Binding LightbarBlue}"
                                               VerticalAlignment="Center"
                                               HorizontalAlignment="Right"
                                               FontFamily="Consolas"
                                               FontSize="12" />
                                </Grid>
                            </StackPanel>

                            <!-- Preview and Presets -->
                            <StackPanel Grid.Column="1" Spacing="8">
                                <!-- Current Color Preview -->
                                <Border Background="{Binding LightbarPreviewColor}"
                                        CornerRadius="6"
                                        Height="48"
                                        BorderBrush="{DynamicResource DividerStrokeColorDefaultBrush}"
                                        BorderThickness="2">
                                    <TextBlock Text="{Binding LightbarColorHex}"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center"
                                               FontFamily="Consolas"
                                               FontSize="13"
                                               FontWeight="SemiBold"
                                               Foreground="White">
                                        <TextBlock.Effect>
                                            <DropShadowEffect Color="Black"
                                                              BlurRadius="4"
                                                              OffsetX="0"
                                                              OffsetY="0" />
                                        </TextBlock.Effect>
                                    </TextBlock>
                                </Border>

                                <!-- Color Presets -->
                                <UniformGrid Rows="2" Columns="4">
                                    <Button Background="#FF0000" Command="{Binding SetLightbarPresetCommand}" CommandParameter="255,0,0" Padding="0" Margin="2" />
                                    <Button Background="#00FF00" Command="{Binding SetLightbarPresetCommand}" CommandParameter="0,255,0" Padding="0" Margin="2" />
                                    <Button Background="#0000FF" Command="{Binding SetLightbarPresetCommand}" CommandParameter="0,0,255" Padding="0" Margin="2" />
                                    <Button Background="#FFFF00" Command="{Binding SetLightbarPresetCommand}" CommandParameter="255,255,0" Padding="0" Margin="2" />
                                    <Button Background="#FF00FF" Command="{Binding SetLightbarPresetCommand}" CommandParameter="255,0,255" Padding="0" Margin="2" />
                                    <Button Background="#00FFFF" Command="{Binding SetLightbarPresetCommand}" CommandParameter="0,255,255" Padding="0" Margin="2" />
                                    <Button Background="#FFFFFF" Command="{Binding SetLightbarPresetCommand}" CommandParameter="255,255,255" Padding="0" Margin="2" />
                                    <Button Background="#FFA500" Command="{Binding SetLightbarPresetCommand}" CommandParameter="255,165,0" Padding="0" Margin="2" />
                                </UniformGrid>
                            </StackPanel>
                        </Grid>

                        <!-- Apply Button -->
                        <Button Content="Apply Lightbar Color"
                                HorizontalAlignment="Stretch"
                                Command="{Binding ApplyLightbarCommand}">
                            <Button.Styles>
                                <Style Selector="Button">
                                    <Setter Property="Background" Value="{DynamicResource AccentFillColorDefaultBrush}" />
                                </Style>
                            </Button.Styles>
                        </Button>
                    </StackPanel>
                </Border>

                <!-- Player LEDs Section -->
                <Border Background="{DynamicResource LayerFillColorDefaultBrush}"
                        CornerRadius="8"
                        Padding="16"
                        Grid.Row="2"
                        Grid.Column="0">
                    <StackPanel Spacing="12">
                        <TextBlock Text="Player LEDs"
                                   FontSize="14"
                                   FontWeight="SemiBold" />

                        <!-- LED Toggles -->
                        <UniformGrid Columns="5" HorizontalAlignment="Stretch">
                            <ToggleButton Content="1"
                                          IsChecked="{Binding PlayerLed1}"
                                          Height="45"
                                          FontSize="16"
                                          FontWeight="SemiBold"
                                          Margin="2" />
                            <ToggleButton Content="2"
                                          IsChecked="{Binding PlayerLed2}"
                                          Height="45"
                                          FontSize="16"
                                          FontWeight="SemiBold"
                                          Margin="2" />
                            <ToggleButton Content="3"
                                          IsChecked="{Binding PlayerLed3}"
                                          Height="45"
                                          FontSize="16"
                                          FontWeight="SemiBold"
                                          Margin="2" />
                            <ToggleButton Content="4"
                                          IsChecked="{Binding PlayerLed4}"
                                          Height="45"
                                          FontSize="16"
                                          FontWeight="SemiBold"
                                          Margin="2" />
                            <ToggleButton Content="5"
                                          IsChecked="{Binding PlayerLed5}"
                                          Height="45"
                                          FontSize="16"
                                          FontWeight="SemiBold"
                                          Margin="2" />
                        </UniformGrid>

                        <!-- Brightness and Presets -->
                        <Grid ColumnDefinitions="*,*" ColumnSpacing="8">
                            <StackPanel Spacing="6">
                                <TextBlock Text="Brightness"
                                           FontSize="11"
                                           Foreground="{DynamicResource TextFillColorSecondaryBrush}" />
                                <ComboBox SelectedIndex="{Binding PlayerLedBrightnessIndex}"
                                          HorizontalAlignment="Stretch">
                                    <ComboBoxItem Content="High" />
                                    <ComboBoxItem Content="Medium" />
                                    <ComboBoxItem Content="Low" />
                                </ComboBox>
                            </StackPanel>

                            <StackPanel Grid.Column="1" Spacing="6">
                                <TextBlock Text="Quick Select"
                                           FontSize="11"
                                           Foreground="{DynamicResource TextFillColorSecondaryBrush}" />
                                <UniformGrid Columns="3">
                                    <Button Content="All" Command="{Binding SetPlayerLedsCommand}" CommandParameter="All" Margin="1" Padding="4" FontSize="11" />
                                    <Button Content="Off" Command="{Binding SetPlayerLedsCommand}" CommandParameter="None" Margin="1" Padding="4" FontSize="11" />
                                    <Button Content="Mid" Command="{Binding SetPlayerLedsCommand}" CommandParameter="Center" Margin="1" Padding="4" FontSize="11" />
                                </UniformGrid>
                            </StackPanel>
                        </Grid>

                        <!-- Apply Button -->
                        <Button Content="Apply Player LEDs"
                                HorizontalAlignment="Stretch"
                                Command="{Binding ApplyPlayerLedsCommand}">
                            <Button.Styles>
                                <Style Selector="Button">
                                    <Setter Property="Background" Value="{DynamicResource AccentFillColorDefaultBrush}" />
                                </Style>
                            </Button.Styles>
                        </Button>
                    </StackPanel>
                </Border>

                <!-- Mic LED and Reset Section -->
                <Border Background="{DynamicResource LayerFillColorDefaultBrush}"
                        CornerRadius="8"
                        Padding="16"
                        Grid.Row="2"
                        Grid.Column="1">
                    <StackPanel Spacing="12">
                        <!-- Mic LED -->
                        <StackPanel Spacing="8">
                            <Grid ColumnDefinitions="Auto,*">
                                <ic:SymbolIcon Symbol="Mic"
                                               FontSize="14"
                                               Margin="0,0,6,0"
                                               VerticalAlignment="Center" />
                                <TextBlock Text="Microphone LED"
                                           FontSize="14"
                                           FontWeight="SemiBold"
                                           VerticalAlignment="Center"
                                           Grid.Column="1" />
                            </Grid>

                            <!-- Mic LED Options in Horizontal Layout -->
                            <UniformGrid Columns="3">
                                <RadioButton Content="Off"
                                             GroupName="MicLed"
                                             IsChecked="{Binding MicLed, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=Off, Mode=TwoWay}"
                                             FontSize="12"
                                             Margin="2" />
                                <RadioButton Content="On"
                                             GroupName="MicLed"
                                             IsChecked="{Binding MicLed, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=On, Mode=TwoWay}"
                                             FontSize="12"
                                             Margin="2" />
                                <RadioButton Content="Pulse"
                                             GroupName="MicLed"
                                             IsChecked="{Binding MicLed, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=Pulse, Mode=TwoWay}"
                                             FontSize="12"
                                             Margin="2" />
                            </UniformGrid>

                            <!-- Apply Button -->
                            <Button Content="Apply Mic LED"
                                    HorizontalAlignment="Stretch"
                                    Command="{Binding ApplyMicLedCommand}">
                                <Button.Styles>
                                    <Style Selector="Button">
                                        <Setter Property="Background" Value="{DynamicResource AccentFillColorDefaultBrush}" />
                                    </Style>
                                </Button.Styles>
                            </Button>
                        </StackPanel>

                        <Border Height="1"
                                Background="{DynamicResource DividerStrokeColorDefaultBrush}"
                                Margin="0,4" />

                        <!-- Reset Options -->
                        <StackPanel Spacing="8">
                            <TextBlock Text="Reset Options"
                                       FontSize="14"
                                       FontWeight="SemiBold" />
                            <UniformGrid Rows="2">
                                <Button Content="Reset to Default"
                                        Command="{Binding ResetLightsToDefaultCommand}"
                                        Margin="0,0,0,4">
                                    <Button.Styles>
                                        <Style Selector="Button">
                                            <Setter Property="Background" Value="{DynamicResource SystemFillColorCautionBrush}" />
                                        </Style>
                                    </Button.Styles>
                                </Button>
                                <Button Content="Turn Off All Lights"
                                        Command="{Binding TurnOffAllLightsCommand}">
                                    <Button.Styles>
                                        <Style Selector="Button">
                                            <Setter Property="Background" Value="{DynamicResource SystemFillColorCriticalBrush}" />
                                        </Style>
                                    </Button.Styles>
                                </Button>
                            </UniformGrid>
                        </StackPanel>
                    </StackPanel>
                </Border>
            </Grid>
        </StackPanel>
    </Border>
</UserControl>